{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import assert from\"node:assert/strict\";process.env.PROMISING_TWITTER_MIN_FOLLOWERS=\"100\";process.env.PROMISING_FARCASTER_MIN_FOLLOWERS=\"200\";process.env.TWITTER_API_KEY=process.env.TWITTER_API_KEY??\"test-key\";process.env.CLANKER_API_KEY=\"test-clanker\";process.env.NEYNAR_API_KEY=\"test-neynar\";process.env.ZORA_API_KEY=\"test-zora\";process.env.SMART_FOLLOWER_AUTO_RUN=\"false\";const createResponse=__name(data=>({ok:true,status:200,json:__name(async()=>data,\"json\")}),\"createResponse\");const followerMap={nohandle:0,lowhandle:50,passhandle:1e3};const farcasterMap={\"42\":50,\"43\":500};globalThis.fetch=(async input=>{const url=typeof input===\"string\"?input:input instanceof URL?input.toString():input.url;if(url.includes(\"twitterapi.io\")){const handle=new URL(url).searchParams.get(\"userName\")??\"\";const followers=followerMap[handle]??0;return createResponse({data:{followers}})}if(url.includes(\"api.farcaster.xyz\")){const fid=new URL(url).searchParams.get(\"fid\")??\"\";const followers=farcasterMap[fid]??0;return createResponse({result:{user:{followerCount:followers}}})}if(url.includes(\"clanker.world\")){return createResponse({data:{requestor_fid:43,social_context:{platform:\"Farcaster\"},msg_sender:\"0xabc\"}})}if(url.includes(\"api.neynar.com\")){return createResponse({users:[{follower_count:1e3,username:\"creator\",verified_addresses:{eth_addresses:[\"0xabc\"]}}]})}if(url.includes(\"api-sdk.zora.engineering\")){return createResponse({data:{zora20Token:{creatorProfile:{socialAccounts:{farcaster:{id:43,username:\"creator\",followerCount:1200}}}}}})}throw new Error(`Unhandled fetch for ${url}`)});const{enforcePromisingSocialGate}=await import(\"../src/utils/socialProof\").then(s=>{const e=\"default\";return s[e]&&typeof s[e]==\"object\"&&\"__esModule\"in s[e]?s[e]:s});const wrapEntry=__name(entry=>({token:entry.token,status:\"active\",firstSeen:new Date().toISOString(),pools:[],quoteTokens:[],community:entry.community,identity:entry.identity}),\"wrapEntry\");const missingHandle=wrapEntry({token:\"0xmissing\"});const missingResult=await enforcePromisingSocialGate(missingHandle);assert.equal(missingResult.passes,false);assert.ok(missingResult.reasons.includes(\"Twitter handle missing\"));const lowHandle=wrapEntry({token:\"0xlow\",community:{twitter:\"https://twitter.com/lowhandle\"}});const lowResult=await enforcePromisingSocialGate(lowHandle);assert.equal(lowResult.passes,false);assert.ok(lowResult.reasons.includes(\"Twitter followers 50 < 100\"));assert.equal(lowResult.stats.twitter?.handle,\"lowhandle\");assert.equal(lowResult.stats.twitter?.followers,50);const farcasterFail=wrapEntry({token:\"0xfarcasterFail\",community:{twitter:\"https://twitter.com/passhandle\"},identity:{platform:\"clanker\",creatorFid:42}});const farcasterResult=await enforcePromisingSocialGate(farcasterFail);assert.equal(farcasterResult.passes,false);assert.ok(farcasterResult.reasons.includes(\"Farcaster followers 50 < 200\"));const passEntry=wrapEntry({token:\"0xpass\",community:{twitter:\"https://twitter.com/passhandle\"},identity:{platform:\"clanker\",creatorFid:43}});const passResult=await enforcePromisingSocialGate(passEntry);assert.equal(passResult.passes,true);assert.equal(passResult.stats.twitter?.handle,\"passhandle\");assert.equal(passResult.stats.twitter?.followers,1e3);const identityHandle=wrapEntry({token:\"0xidentity\",identity:{twitter:\"@passhandle\",creatorFid:43}});const identityResult=await enforcePromisingSocialGate(identityHandle);assert.equal(identityResult.passes,true);assert.equal(identityResult.stats.twitter?.handle,\"passhandle\");console.log(\"[social-gate:test] All scenarios passed\");\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/home/taygun/Masaüstü/base/ponder-base-createpool2/scripts/testSocialGate.ts"],"sourcesContent":[null]}}